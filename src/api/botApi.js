import apiClient from './apiClient';

/**
 * Отправка запроса к боту
 * @param {Object} requestData - Данные запроса
 * @param {string} requestData.type - Тип запроса
 * @param {string} requestData.query - Текст запроса
 * @param {string} [requestData.model] - Модель AI (опционально)
 * @returns {Promise<Object>} Ответ от бота
 */
export const sendBotRequest = async (requestData) => {
  try {
    // В режиме разработки используем моки данных
    if (process.env.NODE_ENV === 'development') {
      return mockBotResponse(requestData);
    }
    
    const response = await apiClient.post('/bot/request', requestData);
    return response.data;
  } catch (error) {
    console.error('Error sending bot request:', error);
    
    // В случае ошибки используем моки в режиме разработки
    if (process.env.NODE_ENV === 'development') {
      return mockBotResponse(requestData);
    }
    
    throw error;
  }
};

/**
 * Получение информации о доступных моделях AI
 * @returns {Promise<Array>} Список моделей
 */
export const fetchAvailableModels = async () => {
  try {
    // В режиме разработки используем моки данных
    if (process.env.NODE_ENV === 'development') {
      return mockModels();
    }
    
    const response = await apiClient.get('/bot/models');
    return response.data;
  } catch (error) {
    console.error('Error fetching available models:', error);
    
    // В случае ошибки используем моки в режиме разработки
    if (process.env.NODE_ENV === 'development') {
      return mockModels();
    }
    
    throw error;
  }
};

/**
 * Получение списка типов запросов к боту
 * @returns {Promise<Array>} Список типов запросов
 */
export const fetchRequestTypes = async () => {
  try {
    // В режиме разработки используем моки данных
    if (process.env.NODE_ENV === 'development') {
      return mockRequestTypes();
    }
    
    const response = await apiClient.get('/bot/request-types');
    return response.data;
  } catch (error) {
    console.error('Error fetching request types:', error);
    
    // В случае ошибки используем моки в режиме разработки
    if (process.env.NODE_ENV === 'development') {
      return mockRequestTypes();
    }
    
    throw error;
  }
};

// Моки данных для разработки
const mockBotResponse = (requestData) => {
  // Имитируем задержку сервера
  const delay = Math.floor(Math.random() * 1000) + 500; // от 500 до 1500 мс
  
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve({
        id: Date.now().toString(),
        type: requestData.type,
        query: requestData.query,
        response: getMockResponseByType(requestData.type, requestData.query),
        model: requestData.model || 'default',
        createdAt: new Date().toISOString(),
      });
    }, delay);
  });
};

const getMockResponseByType = (type, query) => {
  const responses = {
    generate_task: `# Задание: Изучение основ ${query}\n\n## Уровень сложности\nСредний\n\n## Цель задания\nПонять и применить базовые концепции ${query}\n\n## Необходимые знания\n- Основы программирования\n- Базовое понимание алгоритмов\n\n## Описание задания\nРазработайте программу, которая демонстрирует ключевые принципы ${query}.\n\n## Пошаговые инструкции\n1. Изучите теоретические основы\n2. Разработайте алгоритм решения\n3. Реализуйте код\n4. Протестируйте решение\n\n## Критерии успешного выполнения\n- Программа работает корректно\n- Код хорошо структурирован и документирован\n\n## Пример решения\n\`\`\`\nprint("Пример решения для ${query}")\n\`\`\`\n\n## Дополнительные задачи\n- Оптимизируйте решение\n- Добавьте интерфейс пользователя`,
    
    find_resources: `# Образовательные ресурсы: ${query}\n\n## Учебники и книги\n- "Основы ${query}" - фундаментальное руководство для начинающих\n- "Продвинутые техники в ${query}" - для опытных специалистов\n\n## Онлайн-курсы\n- [Coursera: ${query} для начинающих](https://coursera.org) - структурированный курс с практическими заданиями\n- [Udemy: Мастер-класс по ${query}](https://udemy.com) - интенсивный курс для быстрого освоения\n\n## Видеоматериалы\n- [YouTube: Канал о ${query}](https://youtube.com) - понятные объяснения базовых концепций\n- [YouTube: Практика ${query}](https://youtube.com) - практические примеры применения\n\n## Практические ресурсы\n- [GitHub: Репозиторий примеров ${query}](https://github.com) - множество готовых примеров\n- [${query} Playground](https://example.com) - интерактивная среда для практики\n\n## Сообщества для обсуждения\n- [Stack Overflow: Тег ${query}](https://stackoverflow.com) - ответы на технические вопросы\n- [Reddit: r/${query}](https://reddit.com) - обсуждения и обмен опытом`,
    
    answer_question: `# Ответ на вопрос: ${query}\n\n## Краткий ответ\n${query} - это важная концепция в современном образовании, которая включает в себя несколько ключевых компонентов.\n\n## Подробное объяснение\nКонцепция ${query} основана на принципах активного обучения и практического применения знаний. Она включает следующие компоненты:\n\n- Теоретическая база\n- Практическое применение\n- Рефлексия и анализ\n\nКаждый из этих компонентов играет важную роль в общем процессе обучения.\n\n## Примеры применения\n1. Пример из образовательной практики\n2. Пример из профессиональной сферы\n3. Пример из повседневной жизни\n\n## Дополнительные ресурсы\nДля более глубокого понимания ${query} рекомендуем изучить:\n\n- Книга "Основы ${query}"\n- Онлайн-курс "${query} на практике"\n- Научные статьи по теме`,
    
    create_lesson_plan: `# План урока: ${query}\n\n## Информация об уроке\n- **Продолжительность**: 90 минут\n- **Уровень**: Средний\n- **Целевая аудитория**: Студенты высших учебных заведений\n\n## Цели урока\n- Понять ключевые концепции ${query}\n- Научиться применять знания на практике\n- Развить навыки критического мышления\n\n## Необходимые материалы\n- Презентация по теме ${query}\n- Раздаточные материалы с основными понятиями\n- Компьютеры с необходимым ПО\n\n## Подготовка преподавателя\n- Изучить актуальные исследования по теме\n- Подготовить примеры из практики\n\n## План проведения\n### 1. Вводная часть (15 минут)\n- Приветствие и обзор темы\n- Короткий опрос для выявления начальных знаний\n\n### 2. Основная часть (40 минут)\n- Презентация ключевых концепций\n- Демонстрация примеров\n- Обсуждение практических применений\n\n### 3. Практическая работа (20 минут)\n- Выполнение практического задания в группах\n- Консультирование студентов\n\n### 4. Обсуждение и рефлексия (10 минут)\n- Презентация результатов работы групп\n- Обсуждение возникших трудностей\n\n### 5. Заключение (5 минут)\n- Подведение итогов\n- Анонс следующей темы\n\n## Домашнее задание\n- Выполнить исследовательский проект по теме ${query}\n- Подготовить краткую презентацию результатов\n\n## Дополнительные материалы и ресурсы\n- Книга "Основы ${query}"\n- Онлайн-курс по углубленному изучению\n- Научные статьи по теме`,
    
    get_checklist: `# Чек-лист для обучения: ${query}\n\n## Подготовительный этап\n- [ ] Определить цели обучения\n- [ ] Собрать необходимые ресурсы\n- [ ] Составить план обучения\n- [ ] Выделить время для регулярных занятий\n\n## Основные знания и навыки\n- [ ] Базовые концепции ${query}\n  - [ ] Теоретические основы\n  - [ ] Терминология и определения\n- [ ] Промежуточные навыки\n  - [ ] Практические методики\n  - [ ] Типовые задачи и их решения\n- [ ] Продвинутые техники\n  - [ ] Специализированные подходы\n  - [ ] Оптимизация и улучшение\n\n## Практические упражнения\n- [ ] Выполнить базовые упражнения\n- [ ] Решить задачи среднего уровня сложности\n- [ ] Разработать собственный проект\n- [ ] Получить обратную связь от экспертов\n\n## Проверка понимания\n- [ ] Пройти тестирование по базовым концепциям\n- [ ] Объяснить ключевые идеи своими словами\n- [ ] Применить знания в новом контексте\n- [ ] Проанализировать собственные решения\n\n## Ресурсы для углубления знаний\n- [ ] Изучить рекомендованную литературу\n- [ ] Пройти онлайн-курсы по теме\n- [ ] Присоединиться к профессиональным сообществам\n- [ ] Следить за новостями и обновлениями в области\n\n## Финальный проект/демонстрация знаний\n- [ ] Определить тему проекта\n- [ ] Разработать план реализации\n- [ ] Выполнить проект с применением полученных знаний\n- [ ] Представить результаты и получить обратную связь\n\n## График обучения\n- Неделя 1: Освоение базовых концепций\n- Неделя 2: Практика решения типовых задач\n- Неделя 3: Изучение продвинутых техник\n- Неделя 4: Работа над финальным проектом`,
    
    get_prompt_guide: `# Руководство по составлению запросов к AI для изучения ${query}\n\n## Общие принципы составления запросов\n- Формулируйте четкие и конкретные вопросы\n- Указывайте контекст и предысторию\n- Определяйте желаемый формат ответа\n- Уточняйте уровень детализации\n- Разбивайте сложные темы на подзадачи\n\n## Структура эффективного запроса\n1. Тема или предметная область\n2. Конкретный вопрос или задача\n3. Контекст и предпосылки\n4. Желаемый формат ответа\n5. Ограничения или дополнительные требования\n\n## Примеры запросов для разных целей\n\n### Для получения объяснения концепции\n**Неэффективно**: "Расскажи про ${query}"\n**Эффективно**: "Объясни концепцию ${query} на уровне студента 2 курса, с акцентом на практическое применение и приведи 2-3 конкретных примера"\n**Почему это работает**: Запрос содержит целевую аудиторию, фокус и конкретные требования к формату ответа\n\n### Для решения практической задачи\n**Неэффективно**: "Как решить задачу по ${query}?"\n**Эффективно**: "Помоги решить задачу по ${query}: [описание задачи]. Покажи пошаговое решение с объяснениями каждого шага и альтернативные подходы, если они существуют"\n**Почему это работает**: Включает полное описание задачи и указывает формат желаемого ответа\n\n### Для получения учебных материалов\n**Неэффективно**: "Материалы для изучения ${query}"\n**Эффективно**: "Подбери структурированный список ресурсов для изучения ${query} для начинающего уровня, включая книги, онлайн-курсы и практические задания. Укажи примерную продолжительность изучения каждого ресурса и почему он полезен"\n**Почему это работает**: Уточняет уровень, типы ресурсов и дополнительную информацию о них\n\n## Типичные ошибки и как их избежать\n- Слишком общие запросы: добавляйте конкретику и детали\n- Отсутствие контекста: указывайте предпосылки и цели\n- Чрезмерная сложность: разбивайте на подзадачи\n- Нечеткие ожидания: указывайте формат желаемого ответа\n\n## Продвинутые техники\n- Техника "Цепочка рассуждений": просите AI мыслить пошагово\n- Техника "Эксперт в роли": просите ответить с позиции эксперта в определенной области\n- Техника "Несколько перспектив": просите рассмотреть вопрос с разных точек зрения\n\n## Шаблоны запросов для регулярного использования\n\`\`\`\nОбъясни [концепция] в контексте [область] на уровне [начинающий/средний/продвинутый]. Включи [примеры/диаграммы/сравнения] и предложи дальнейшие ресурсы для изучения.\n\`\`\`\n\`\`\`\nПомоги решить задачу: [описание задачи]. Предоставь пошаговое решение с объяснениями, а также подсказки, как я мог бы самостоятельно прийти к решению.\n\`\`\``,
    
    get_study_materials: `# Учебные материалы: ${query}\n\n## Ключевые концепции\n1. Основы ${query}\n   - Фундаментальные принципы и определения\n   - Важность в современном контексте\n   - Примеры практического применения\n2. Методология изучения ${query}\n   - Структурированный подход к освоению\n   - Типичные проблемы и их решения\n   - Метрики прогресса и понимания\n\n## Теоретические материалы\n### Основные принципы\n- Принцип систематизации знаний\n- Принцип практического применения\n- Принцип постепенного усложнения\n\n### Методология\n- Подход "от теории к практике"\n- Методика активного обучения\n- Техники запоминания и повторения\n\n## Практические материалы\n### Упражнения для самостоятельной работы\n1. Базовое упражнение по ${query}\n   - Цель: Закрепление фундаментальных понятий\n   - Инструкции: Выполните анализ представленной информации\n   - Ожидаемый результат: Структурированный отчет\n2. Продвинутое практическое задание\n   - Цель: Применение комплексных знаний\n   - Инструкции: Разработайте собственное решение проблемы\n   - Ожидаемый результат: Рабочий проект с документацией\n\n### Примеры для разбора\n\`\`\`\nПример 1: Базовое применение ${query}\n\`\`\`\nДемонстрирует основные принципы на простом примере, показывая пошаговое решение типичной задачи.\n\n\`\`\`\nПример 2: Комплексный случай в ${query}\n\`\`\`\nИллюстрирует применение продвинутых техник в более сложном сценарии с анализом результатов.\n\n## Дополнительные ресурсы\n- Книга "Фундаментальные основы ${query}": Всестороннее руководство для начинающих\n- Онлайн-курс "Практический ${query}": Интерактивные лекции и задания\n- Сообщество практиков ${query}: Обсуждения и обмен опытом\n\n## План изучения\n1. Неделя 1-2: Изучение базовых концепций и терминологии\n2. Неделя 3-4: Практика на простых примерах\n3. Неделя 5-6: Углубленное изучение сложных тем\n4. Неделя 7-8: Работа над собственным проектом`,
    
    get_feedback: `# Обратная связь: ${query}\n\n## Сильные стороны\n- Структурированный подход: Ваша работа демонстрирует логическую последовательность и четкую организацию материала.\n- Глубина анализа: Вы успешно раскрыли ключевые аспекты темы, показав хорошее понимание предмета.\n- Использование источников: Ваша работа опирается на релевантные и авторитетные источники, что усиливает аргументацию.\n\n## Области для улучшения\n- Практические примеры: Работа выиграла бы от большего количества конкретных примеров, иллюстрирующих теоретические положения.\n- Критический анализ: Рекомендуется добавить более глубокий критический анализ различных точек зрения на проблему.\n- Структура аргументации: Некоторые аргументы могли бы быть представлены более последовательно, с четким выделением тезисов и доказательств.\n\n## Рекомендации по дальнейшему развитию\n1. Расширьте практическую составляющую, добавив реальные кейсы и примеры применения.\n2. Углубите теоретическую базу, изучив дополнительные источники по теме.\n3. Поработайте над стилем изложения, стремясь к большей ясности и лаконичности.\n4. Рассмотрите альтернативные подходы к решению представленных проблем.\n\n## Полезные ресурсы для совершенствования\n- "Руководство по академическому письму": поможет усовершенствовать структуру и стиль работы.\n- "Методы критического анализа": предоставит инструменты для более глубокого анализа.\n- Онлайн-курс по теме ${query}: позволит расширить знания в выбранной области.\n\n## Общая оценка и направление роста\nВаша работа демонстрирует хороший уровень понимания темы и навыков академического письма. Для дальнейшего профессионального роста рекомендуется сосредоточиться на развитии навыков критического анализа, более глубоком изучении практических аспектов темы и совершенствовании структуры аргументации. Эти улучшения помогут вам перейти от хорошего уровня работы к отличному.`,
  };
  
  // Возвращаем мок-ответ по типу запроса или общий ответ, если тип не найден
  return responses[type] || `Ответ на запрос: ${query}`;
};

const mockModels = () => [
  {
    id: 'default',
    name: 'GPT-4o mini',
    description: 'Быстрая и эффективная модель для большинства образовательных задач',
    icon: 'fast',
    isPremium: false,
  },
  {
    id: 'advanced',
    name: 'GPT-4o',
    description: 'Продвинутая модель с глубоким пониманием контекста и сложных концепций',
    icon: 'premium',
    isPremium: true,
  },
  {
    id: 'fast',
    name: 'GPT-3.5 Turbo',
    description: 'Самая быстрая модель для простых запросов и задач',
    icon: 'lightning',
    isPremium: false,
  }
];

const mockRequestTypes = () => [
  {
    id: 'generate_task',
    name: 'Сгенерировать задание',
    description: 'Создание структурированного учебного задания по выбранной теме',
    icon: '📝',
  },
  {
    id: 'find_resources',
    name: 'Найти ресурсы',
    description: 'Подбор релевантных образовательных материалов и ресурсов',
    icon: '🔎',
  },
  {
    id: 'answer_question',
    name: 'Ответить на вопрос',
    description: 'Подробные ответы на вопросы по учебным темам',
    icon: '❓',
  },
  {
    id: 'create_lesson_plan',
    name: 'Составить план урока',
    description: 'Создание структурированного плана занятия',
    icon: '📚',
  },
  {
    id: 'get_checklist',
    name: 'Чек-лист обучения',
    description: 'Создание чек-листа для систематического изучения темы',
    icon: '✅',
  },
  {
    id: 'get_prompt_guide',
    name: 'Гайд по запросам',
    description: 'Рекомендации по составлению эффективных запросов к AI',
    icon: '📋',
  },
  {
    id: 'get_study_materials',
    name: 'Учебные материалы',
    description: 'Комплексные материалы для изучения выбранной темы',
    icon: '📚',
  },
  {
    id: 'get_feedback',
    name: 'Получить обратную связь',
    description: 'Конструктивный анализ и рекомендации по улучшению работы',
    icon: '📊',
  }
]; 